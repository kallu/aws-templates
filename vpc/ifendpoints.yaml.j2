  VpcEndpointSecGroup:
    Type: AWS::EC2::SecurityGroup
    Condition: EnableInterfaceEndpoints
    Properties:
      GroupDescription: !Sub "VPC Interface endpoint sec.group ${AWS::StackName}"
      VpcId: !Ref VPC
      SecurityGroupIngress:
        -
          CidrIp: !Ref VpcCidr
          Description: Allow HTTPS from VPC CIDR
          IpProtocol: tcp
          FromPort: 443
          ToPort: 443
        -
          CidrIp: !If [ IntraAny, !Ref VpcIntraCidr, !Ref AWS::NoValue ]
          Description: Allow HTTPS from VPC secondary CIDR
          IpProtocol: tcp
          FromPort: 443
          ToPort: 443

{# TODO: This is assuming 3 AZ config.json, should be fixed to follow AZs defined in config.json #}
{% for x in InterfaceEndpoints %}
  {{x.name}}vpcEndpoint:
    Type: AWS::EC2::VPCEndpoint
    Condition: EnableInterfaceEndpoints
    Properties:
      ServiceName: !Sub 'com.amazonaws.${AWS::Region}.{{x.addr}}'
      VpcEndpointType: Interface
      VpcId: !Ref VPC
      PrivateDnsEnabled: true
      SecurityGroupIds:
        - !Ref VpcEndpointSecGroup
      SubnetIds:
      - !If
        - PrivA
        - !Ref PrivSubnetA
        - !Ref AWS::NoValue
      - !If
        - PrivB
        - !Ref PrivSubnetB
        - !Ref AWS::NoValue
      - !If
        - PrivC
        - !Ref PrivSubnetC
        - !Ref AWS::NoValue
{% endfor %}